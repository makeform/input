<div><style type="text/css">img{max-width:100%;max-height:80vh;width:100%;object-fit:contain}.unit,.remains{pointer-events:none;margin-top:-1em;transform:translate(0,0.45em);width:fit-content;line-height:1em;font-size:.66em;text-shadow:0 0 2px #fff,0 0 2px #fff,0 0 2px #fff,0 0 2px #fff,0 0 2px #fff,0 0 2px #fff}.unit{margin-right:.66em;margin-left:auto;transition:margin-right .15s ease-in-out}.remains{margin:-1em 0 0 .5em}.is-invalid+.unit{margin-right:2.75em}</style><script type="@plotdb/block">var wordLen,hint;wordLen=function(n,t){n==null&&(n="");return t==="simple-word"?n.split(/\s|[,.;:!?，。；：︰！？、．　"]/).filter(function(n){return n}).map(function(n){return n.split(/[\u1000-\uffff]/).map(function(n){if(n.length){return 2}else{return 1}}).reduce(function(n,t){return n+t},0)-1}).reduce(function(n,t){return n+t},0):n.length};hint=function(n){var r,t,e,l,u,i;r=n.content,t=n.terms,e=n.t;t=(t||[]).filter(function(n){return n.opset==="length"});l={};if(!t.length){return u=[0,""]}else{i=t.map(function(n){var t,e,u,i;if(n.op==="range"){t=n.config||{},e=t.min,u=t.max}else if(n.op==="lte"){u=(n.config||{}).val}else if(n.op==="gte"){e=(n.config||{}).val}if(e!=null){l.min=(t=l.min||0)>e?t:e}if(u!=null){l.max=(t=!l.max?u:l.max)<u?t:u}i=wordLen(r,n.config.method);l.count=i;return[e!=null?i-e:undefined,u!=null?u-i:undefined]});u=[Math.min.apply(Math,i.map(function(n){return n[0]})),Math.min.apply(Math,i.map(function(n){return n[1]}))];u=l.min!=null&&u[0]<0?[-1,e("還差")+" "+-u[0]+" "+e("字")]:l.max!=null&&u[1]<0?[1,e("超過")+" "+-u[1]+" "+e("字")]:l.max!=null?[0,e("還剩")+" "+u[1]+" "+e("字")]:[0,e("已寫")+" "+l.count+" "+e("字")];return{invalid:!!u[0],text:u[1]}}};var mod;module.exports={pkg:{name:"@makeform/input",extend:{name:"@makeform/common"},dependencies:[{name:"marked",version:"main",path:"marked.min.js"},{name:"dompurify",version:"main",path:"dist/purify.min.js"}],i18n:{en:{"單位":"unit","還差":"remaining to reach:","超過":"exceeded by:","還剩":"remaining:","已寫":"written:","字":"word(s)"},"zh-TW":{"單位":"單位","還差":"還差","超過":"超過","還剩":"還剩","已寫":"已寫","字":"字"}}},init:function(e){return e.pubsub.fire("subinit",{mod:mod(e)})}};mod=function(e){var n,t,i,r,c,u,l,m,o,a;n=e.root,t=e.ctx,i=e.data,r=e.parent,c=e.t;u=t.ldview,l=t.marked,m=t.DOMPurify;o=new l.Renderer;o.link=function(e,n,t){var i;i=l.Renderer.prototype.link.call(this,e,n,t);return i.replace("<a",'<a target="_blank" rel="noopener noreferrer" ')};l.setOptions({renderer:o});a={};return{init:function(){var r,o,a,s,e,f=this;r=this.mod.child;o={};this.on("change",function(e){var n;n=f.content(e);if(!(n!=null)){n=""}if(f.mod.info.config.autoComma){n=s(n)}if(o.get("input").value===n){return}if(o){o.get("input").value=n;return o.render(["preview","input","content"])}});a=function(e){return((e!=null?e:"")+"").replace(/,/g,"")};s=function(e){var n,t,i,r,o,a,u;e=((e!=null?e:"")+"").trim().replace(/,/g,"");n=/^([0-9-]+)((?:\.?.+)?)$/.exec(e);if(!n){return e}t=["",n[1].split("")],i=t[0],r=t[1];for(o=0,a=r.length;o<a;++o){u=o;i=r[r.length-u-1]+i;if(u%3===2&&u<r.length-1&&/[0-9]/.exec(r[r.length-u-2]||"")){i=","+i}}return i+n[2]};e=function(e){var n,t,i;n=e.node;t=!f.mod.info.config.autoComma?n.value:a(n.value);if(f.content(i=f.value())===t){return}if(i&&typeof i==="object"){i.v=t}else{i={v:t}}return f.value(i)};if(!n){return}return r.view=o=new u({root:n,action:{input:{input:e},change:{input:e,"enable-markdown-input":function(e){var n,t,i;n=e.node;t=n.checked;if(!t){r.preview=false}if(typeof(i=f.value())!=="object"){i={v:i||""}}i.markdown=t;f.value(i);return o.render()}},click:{mode:function(e){var n;n=e.node;if(!f.mod.info.config.showMarkdownOption){return}r.preview=n.getAttribute("data-name")==="preview"?true:false;return o.render()}}},text:{unit:function(e){var n;n=e.node;return c(f.mod.info.config.unit||"")}},handler:{remains:function(e){var n,t,i,r,o;n=e.node;t=!!(f.mod.info.config.hint||{}).enabled;n.classList.toggle("d-none",!t);if(!t){return n.textContent=""}i=(f.content()||"")+"";r=f.serialize().term;o=hint({content:i,terms:r,t:c});n.textContent=o.text;return n.classList.toggle("text-danger",!!o.invalid)},"enable-markdown-input":function(e){var n;n=e.node;return n.checked=(f.value()||{}).markdown},"has-unit":function(e){var n;n=e.node;return n.classList.toggle("d-none",!f.mod.info.config.unit)},"enable-markdown":function(e){var n;n=e.node;return n.classList.toggle("d-none",!f.mod.info.config.showMarkdownOption)},mode:function(e){var n,t,i;n=e.node;t=(f.value()||{}).markdown&&f.mod.info.config.showMarkdownOption;n.classList.toggle("d-none",!t);return n.classList.toggle("active",!(!r.preview!==!(i=n.getAttribute("data-name")==="preview")&&(r.preview||i)))},preview:function(e){var n;n=e.node;if(!o){return}n.classList.toggle("d-none",!r.preview);return n.innerHTML=m.sanitize(l.parse(o.get("input").value))},input:function(e){var n,t;n=e.node;t=!!f.mod.info.meta.readonly;if(t){n.setAttribute("readonly",true)}else{n.removeAttribute("readonly")}n.classList.toggle("is-invalid",f.status()===2);if(f.mod.info.config.placeholder){return n.setAttribute("placeholder",f.mod.info.config.placeholder)}else{return n.removeAttribute("placeholder")}},content:function(e){var i,n,t,r,o,a,u,d;i=e.node;n=f.content();t=f.value()||{};if(!f.isEmpty()&&f.mod.info.config.autoComma){n=s(n)}r=f.isEmpty()?"n/a":n+((o=f.mod.info.config.unit)?" "+c(o):"");i.classList.toggle("text-muted",f.isEmpty());i.innerText=r;a=f.mod.info.config.showMarkdownOption&&t.markdown;if(!a){i.innerText=r}else{i.innerHTML=m.sanitize(l.parse(n))}if(f.mod.info.config.asLink&&!f.isEmpty()){u=n.replace(/^(javascript:|data:)/,"");if(!/^https?:\/\//.exec(u)){u="https://"+u}if(/^https?:\/\/[^.\s]+\.[^.\s]+/.exec(u)){i.innerHTML="";i.appendChild(d=document.createElement("a"));d.setAttribute("href",u);d.setAttribute("target","_blank");d.setAttribute("rel","noreferrer noopener");d.innerText=r}}else if(f.mod.info.config.withLink&&!f.isEmpty()){i.innerHTML="";n.split(/([\s])/).map(function(e,n){var t;if(/^https?:\/\/[^.\s]+\.[^.\s]+/.exec(e)){t=document.createElement("a");t.setAttribute("href",e);t.setAttribute("target","_blank");t.setAttribute("rel","noreferrer noopener");t.innerText=e}else{t=document.createTextNode(e)}return i.appendChild(t)})}if(f.mod.info.config.asImage&&!f.isEmpty()){i.innerHTML="";i.appendChild(d=document.createElement("img"));return d.setAttribute("src",r)}}}})},render:function(){if(this.mod.child.view){return this.mod.child.view.render()}},isEmpty:function(e){e=this.content(e);return typeof e==="undefined"||typeof e==="string"&&e.trim()===""||e===null},isEqual:function(e,n){var t,i;t=this.isEmpty(e);i=this.isEmpty(n);if(!t!==!i&&(t||i)){return false}if(t&&i){if((e||n)&&(e||{}).markdown!==(n||{}).markdown){return false}return true}return JSON.stringify(e)===JSON.stringify(n)},content:function(e){if(e&&typeof e==="object"){return e.v}else{return e}}}};</script><div plug="body"><div class="m-edit has-tips manual" ld="error-root"><input class="form-control" ld="input" autocomplete="off" autocapitalize="off"><div class="unit text-muted" ld="has-unit"><span t>單位</span>: <span ld="unit"> ...</span></div><div class="remains text-muted" ld="remains"></div><div class="hover-tip tip-sm"><div ld-each="error"></div></div></div><div class="m-view" ld="content"></div></div></div>
